<!DOCTYPE html>
<html>
    <head>
        <title>px-context-browser Demo</title>

        <!-- Requires Webcomponents.js polyfill is provided by the page for browsers that don't support html imports -->
        <script src="../webcomponentsjs/webcomponents.js"></script>

        <!-- for demo only...never do this. Rely on Angular $q if using angular or load this via amd or other loader -->
        <script src="../q/q.js"></script>

        <!-- Import custom element. Note: see comment about relative paths to dependencies in the *.html file referenced below -->
        <link rel="import" href="../px-theme/px-theme.html"/>

        <link rel="import" href="px-context-browser.html"/>

        <style is="x-style">
          html {
            height: 100%;
            font-size:0.9375em;
          }
          body {
            height: 100%;
            margin: 0;
            background-color: #DDD;
          }
          .demo {
            padding: 1rem;
          }
        </style>
        <style>
          .column-browser-container {
            height: 240px; /* MUST SPECIFY and cannot be 100% without another container */
          }
        </style>
    </head>

    <body>

      <article class="demo">

        <h3>Demo</h3>

        <p>
            Although related, examples are /not/ the same as the test fixtures.
            Tests are tests, examples are examples.
        </p>

        <p>
            Also see the <a href="index.html">documentation</a> and the <a href="test/spec.html">UI test fixture</a>.
        </p>

        <label><input type="checkbox" onchange="document.querySelector('html').setAttribute('dir',this.checked?'rtl':'ltr')">Invert Horizontal Direction</label>

      </article>

        <px-context-browser
                label-field="name"
                parent-id-field="category"
                id-field="identifier"
                tree-display-levels="3"
                child-key="children">
        </px-context-browser>
        <script>
            var initialContexts = {
                data: [{
                    "name": "Lots of children",
                    "identifier": "001-1",
                    "parent": "top",
                    "classification": "truck",
                    "hasChildren": true
                }, {
                    "name": "Deep nested",
                    "identifier": "001-2",
                    "parent": "top",
                    "classification": "car",
                    "hasChildren": true
                }, {
                    "name": "Nothing Below Me",
                    "identifier": "001-3",
                    "parent": "top",
                    "classification": "car"
                }],
                meta: {
                    total: 3 // total number of entities on all pages (to support pagination)
                }
            };

            window.setTimeout(function() {

                var colBrowser = document.querySelector('px-context-browser');
                colBrowser.handlers = {getChildren: function(parentId, newIndex) {return demoGetChildren(parentId, newIndex )}, isOpenable: function(node) {return node && node.isOpenable}};
                colBrowser.initialContexts = initialContexts;
            }, 2000);

            function demoGetChildren(nodeId, rangeStart) {
                var deferred = Q.defer();
              if(!rangeStart) {
                rangeStart = 0;
              }
                var lotsOfChildren = {
                    data: [{
                        "name": "A",
                        "identifier": "001-1a",
                        "parent": "001-1",
                        "classification": "truck"
                    }, {
                        "name": "B",
                        "identifier": "001-1b",
                        "parent": "001-1",
                        "classification": "car"
                    }, {
                        "name": "C",
                        "identifier": "001-1c",
                        "parent": "001-1",
                        "classification": "car"
                    },{
                        "name": "D",
                        "identifier": "001-1d",
                        "parent": "001-1",
                        "classification": "truck"
                    }, {
                        "name": "E",
                        "identifier": "001-1e",
                        "parent": "001-1",
                        "classification": "car"
                    }, {
                        "name": "F",
                        "identifier": "001-1f",
                        "parent": "001-1",
                        "classification": "car"
                    },{
                        "name": "G",
                        "identifier": "001-1g",
                        "parent": "001-1",
                        "classification": "truck"
                    }, {
                        "name": "H",
                        "identifier": "001-1h",
                        "parent": "001-1",
                        "classification": "car"
                    }, {
                        "name": "I",
                        "identifier": "001-1i",
                        "parent": "001-1",
                        "classification": "car"
                    },
                      {
                        "name": "AA",
                        "identifier": "001-1a",
                        "parent": "001-1",
                        "classification": "truck"
                      }, {
                        "name": "BB",
                        "identifier": "001-1b",
                        "parent": "001-1",
                        "classification": "car"
                      }, {
                        "name": "CC",
                        "identifier": "001-1c",
                        "parent": "001-1",
                        "classification": "car"
                      },{
                        "name": "DD",
                        "identifier": "001-1d",
                        "parent": "001-1",
                        "classification": "truck"
                      }, {
                        "name": "EE",
                        "identifier": "001-1e",
                        "parent": "001-1",
                        "classification": "car"
                      }, {
                        "name": "FF",
                        "identifier": "001-1f",
                        "parent": "001-1",
                        "classification": "car"
                      },{
                        "name": "GG",
                        "identifier": "001-1g",
                        "parent": "001-1",
                        "classification": "truck"
                      }, {
                        "name": "HH",
                        "identifier": "001-1h",
                        "parent": "001-1",
                        "classification": "car"
                      }, {
                        "name": "II",
                        "identifier": "001-1i",
                        "parent": "001-1",
                        "classification": "car"
                      },
                      {
                        "name": "AAA",
                        "identifier": "001-1a",
                        "parent": "001-1",
                        "classification": "truck"
                      }, {
                        "name": "BBB",
                        "identifier": "001-1b",
                        "parent": "001-1",
                        "classification": "car"
                      }, {
                        "name": "CCC",
                        "identifier": "001-1c",
                        "parent": "001-1",
                        "classification": "car"
                      },{
                        "name": "DDD",
                        "identifier": "001-1d",
                        "parent": "001-1",
                        "classification": "truck"
                      }, {
                        "name": "EEE",
                        "identifier": "001-1e",
                        "parent": "001-1",
                        "classification": "car"
                      }, {
                        "name": "FFF",
                        "identifier": "001-1f",
                        "parent": "001-1",
                        "classification": "car"
                      },{
                        "name": "GGG",
                        "identifier": "001-1g",
                        "parent": "001-1",
                        "classification": "truck"
                      }, {
                        "name": "HHH",
                        "identifier": "001-1h",
                        "parent": "001-1",
                        "classification": "car"
                      }, {
                        "name": "III",
                        "identifier": "001-1i",
                        "parent": "001-1",
                        "classification": "car"
                      }],
                    meta: {
                        total: 27 // total number of entities on all pages (to support pagination)
                    }
                };
                var deepNestedChildren = {
                    data: [{
                        "name": "Nested Child",
                        "identifier": "001-2a",
                        "parent": "001-2",
                        "classification": "truck",
                        "isOpenable": true,
                        "hasChildren": true
                    }],
                    meta: {
                        total: 1 // total number of entities on all pages (to support pagination)
                    }
                };

                var deepNestedGrandchildren = {
                    data: [{
                        "name": "Nested Grandchild",
                        "identifier": "001-2aa",
                        "parent": "001-2a",
                        "classification": "truck",
                        "hasChildren": true
                    }],
                    meta: {
                        total: 1 // total number of entities on all pages (to support pagination)
                    }
                };

                var deepNestedGreatGrandchild = {
                    data: [{
                        "name": "Nested Great Grandchild",
                        "identifier": "001-2aaa",
                        "parent": "001-2aa",
                        "classification": "truck",
                        "isOpenable": true
                    }],
                    meta: {
                        total: 1 // total number of entities on all pages (to support pagination)
                    }
                };

                var children;

                if (nodeId === "001-1") {
                    children = lotsOfChildren;
                    var rangeEnd = Math.min(rangeStart + 9, children.data.length); //groups of nine
                    children.data = children.data.slice(rangeStart, rangeEnd);
                }
                else if (nodeId === "001-2") {
                    children = deepNestedChildren;
                }
                else if (nodeId === "001-2a") {
                    children = deepNestedGrandchildren;
                }
                else if (nodeId === "001-2aa") {
                    children = deepNestedGreatGrandchild;
                }
                else {
                  children = {
                    data: [],
                    meta: {
                      total: 0
                    }
                  };
                }

                deferred.resolve(children);

                return deferred.promise;
            }


        </script>

    </body>
</html>
